<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Site Admin — Static JSON Editor</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071226 0%, #071b2a 100%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    .app{max-width:1100px;margin:28px auto;padding:20px;color:#e6eef6}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .side{height:calc(100vh - 120px);overflow:auto}
    .main{height:calc(100vh - 120px);overflow:auto}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
    input[type=text],select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .row{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);border:none;color:#022;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .list{margin-top:10px}
    .list-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass);margin-bottom:8px}
    .small{font-size:13px;color:var(--muted)}
    .thumb{width:72px;height:48px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.04)}
    .controls{display:flex;gap:8px}
    .checkbox{display:inline-flex;align-items:center;gap:8px}
    .hero-preview{height:160px;border-radius:8px;background:#031220;display:flex;align-items:center;justify-content:center;color:var(--muted);position:relative;overflow:hidden}
    .hero-preview img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.4)}
    .hero-text{position:relative;z-index:2;padding:12px}
    .muted-note{font-size:12px;color:var(--muted);margin-top:8px}
    footer{margin-top:12px;display:flex;gap:8px;align-items:center}
    .flex{display:flex;gap:8px}
    .danger{background:#7f1d1d}
    pre{white-space:pre-wrap;word-break:break-word;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#032"/></svg>
      <div>
        <h1>Static Site Admin — single-file</h1>
        <div class="small">Edit pages, heroes, images and settings — saves to <code>data.json</code> you can download/upload.</div>
      </div>
    </header>

    <div class="grid">
      <aside class="card side">
        <label>Global Settings</label>
        <div class="checkbox">
          <input id="transparentHeader" type="checkbox"><label for="transparentHeader" class="small">Transparent header on all pages</label>
        </div>
        <div class="muted-note">When ticked: header starts clear on every page (see the hero through it) and scrolls dark. Untick: header solid black on load.</div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)"/>

        <label>Image Library</label>
        <input id="imageUpload" type="file" accept="image/*" multiple>
        <div id="imageLibrary" class="list" aria-live="polite"></div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)"/>

        <label>Site Data</label>
        <div class="row">
          <button id="downloadJson" class="btn">Download data.json</button>
          <button id="importJsonBtn" class="btn secondary">Import data.json</button>
          <input id="importJson" type="file" accept="application/json" style="display:none">
        </div>

        <div style="margin-top:12px"><button id="resetBtn" class="btn secondary">Reset to defaults</button></div>

        <div style="margin-top:16px" class="small">Quick actions: images stored as data-URLs in the JSON (works with GitHub Pages). For larger sites, upload images to a CDN and paste URLs.</div>
      </aside>

      <main class="card main">
        <section>
          <label>Pages — Page Manager</label>
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <input id="newTitle" type="text" placeholder="Page title (eg: Home)">
            <input id="newSlug" type="text" placeholder="slug (eg: /)">
            <button id="addPage" class="btn">Add page</button>
          </div>
          <div id="pagesList" class="list"></div>
        </section>

        <hr style="margin:18px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)"/>

        <section id="pageEditor" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 id="editingTitle">Editing — </h3>
            <div class="controls">
              <button id="savePage" class="btn">Save page</button>
              <button id="deletePage" class="btn danger">Delete</button>
            </div>
          </div>

          <label>Hero — per-page</label>
          <div style="display:grid;grid-template-columns:1fr 320px;gap:12px;align-items:start">
            <div>
              <label>Hero Behavior</label>
              <select id="heroBehavior">
                <option value="still">Still Image (simple background)</option>
                <option value="parallax">Slow Parallax Scroll (subtle float)</option>
                <option value="carousel">Auto-Rotating Slides (6-sec carousel)</option>
                <option value="video">Embedded Video (YouTube or Vimeo)</option>
                <option value="none">None (just header)</option>
              </select>

              <label style="margin-top:8px">Hero Size</label>
              <select id="heroSize">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
                <option value="full">Full screen</option>
              </select>

              <label style="margin-top:8px">Hero Media URL (image/video) — or pick from library</label>
              <input id="heroMedia" type="text" placeholder="paste image URL or data-URL here">

              <label style="margin-top:8px">Hero: Enable Parallax Motion (per-page)</label>
              <div class="checkbox"><input id="heroParallax" type="checkbox"><label class="small">Enable parallax</label></div>

              <label style="margin-top:8px">Hero: Auto-rotate slides (comma-separated URLs)</label>
              <textarea id="heroSlides" placeholder="url1.jpg, url2.jpg, ..." rows="3"></textarea>

            </div>

            <div>
              <div class="hero-preview" id="heroPreview">
                <div class="hero-text"><strong>Hero preview</strong><div class="small muted-note" id="heroModeNote">Mode: still</div></div>
              </div>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)"/>

          <label>Page content — Rich text blocks</label>
          <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
            <input id="newBlockTitle" type="text" placeholder="Block name (eg: Hero headline)">
            <button id="addBlock" class="btn secondary">Add block</button>
          </div>

          <div id="blocksList" class="list"></div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)"/>

          <label>Advanced / JSON Preview</label>
          <pre id="jsonPreview"></pre>
        </section>

        <footer>
          <div class="small">Last saved: <span id="lastSaved">never</span></div>
        </footer>
      </main>
    </div>
  </div>

  <script>
    // Default data model
    const DEFAULT = {
      settings:{ transparentHeader: false },
      images:[],
      pages:[
        {id:uid(), title:'Home', slug:'/', hero:{behavior:'still', size:'full', media:'', parallax:false, slides:[]}, blocks:[]}
      ]
    };

    // --- Utilities ---
    function uid(){return 'id-'+Math.random().toString(36).slice(2,9)}
    function q(id){return document.getElementById(id)}
    function download(filename, data){ const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; a.click(); URL.revokeObjectURL(url); }

    // State
    let data = loadFromLocal() || DEFAULT;
    let editingPageId = null;

    // --- Initialization ---
    function init(){
      // DOM refs
      const transparentHeader = q('transparentHeader');
      const imageUpload = q('imageUpload');
      const imageLibrary = q('imageLibrary');
      const pagesList = q('pagesList');
      const addPage = q('addPage');
      const newTitle = q('newTitle');
      const newSlug = q('newSlug');
      const importJson = q('importJson');

      transparentHeader.checked = !!data.settings.transparentHeader;
      transparentHeader.addEventListener('change',e=>{ data.settings.transparentHeader = e.target.checked; save(); renderSettings(); })

      imageUpload.addEventListener('change',handleImageUpload);
      q('downloadJson').addEventListener('click', ()=>download('data.json', JSON.stringify(data, null, 2)) );
      q('importJsonBtn').addEventListener('click', ()=>importJson.click());
      importJson.addEventListener('change', async(e)=>{
        const f = e.target.files[0]; if(!f) return; const txt = await f.text(); try{ data = JSON.parse(txt); save(true); render(); alert('Imported data.json'); }catch(err){alert('Invalid JSON')}
      })
      q('resetBtn').addEventListener('click', ()=>{ if(confirm('Reset site to defaults?')){ data = JSON.parse(JSON.stringify(DEFAULT)); save(true); render(); }})

      addPage.addEventListener('click', ()=>{
        const t=newTitle.value.trim()||'Untitled'; const s=newSlug.value.trim()||('/'+t.toLowerCase().replace(/[^a-z0-9]+/g,'-'));
        const p={id:uid(), title:t, slug:s, hero:{behavior:'still',size:'medium',media:'',parallax:false,slides:[]}, blocks:[]}; data.pages.push(p); save(); renderPages(); newTitle.value=''; newSlug.value=''; openEditor(p.id);
      })

      render();
    }

    // --- Image Library ---
    async function handleImageUpload(e){ const files = Array.from(e.target.files); for(const f of files){ const dataUrl = await readFileAsDataURL(f); data.images.unshift({id:uid(),name:f.name,url:dataUrl}); } save(); renderImages(); e.target.value=''; }
    function readFileAsDataURL(file){ return new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(file); }) }
    function renderImages(){ const node = q('imageLibrary'); node.innerHTML=''; for(const img of data.images){ const wrap = document.createElement('div'); wrap.className='list-item'; const left = document.createElement('div'); left.style.display='flex'; left.style.gap='8px'; const im = document.createElement('img'); im.className='thumb'; im.src=img.url; const meta = document.createElement('div'); meta.innerHTML=`<div>${img.name}</div><div class="small">${img.id}</div>`; left.appendChild(im); left.appendChild(meta); const controls = document.createElement('div'); controls.className='controls'; const use = document.createElement('button'); use.className='btn secondary'; use.textContent='Use'; use.addEventListener('click',()=>{ const currentHero = q('heroMedia'); if(currentHero){ currentHero.value = img.url; currentHero.dispatchEvent(new Event('input')); } }); const del = document.createElement('button'); del.className='btn danger'; del.textContent='Delete'; del.addEventListener('click',()=>{ if(confirm('Delete image from library?')){ data.images = data.images.filter(x=>x.id!==img.id); save(); renderImages(); } }); controls.appendChild(use); controls.appendChild(del); wrap.appendChild(left); wrap.appendChild(controls); node.appendChild(wrap); } if(data.images.length===0) node.innerHTML='<div class="small">No images yet. Upload to add.</div>' }

    // --- Pages ---
    function renderPages(){ const node = q('pagesList'); node.innerHTML=''; for(const p of data.pages){ const el = document.createElement('div'); el.className='list-item'; const left = document.createElement('div'); left.style.display='flex'; left.style.flexDirection='column'; left.innerHTML=`<strong>${escapeHtml(p.title)}</strong><div class="small">${escapeHtml(p.slug)}</div>`; const controls = document.createElement('div'); const editBtn = document.createElement('button'); editBtn.className='btn secondary'; editBtn.textContent='Edit'; editBtn.addEventListener('click',()=>openEditor(p.id)); const del = document.createElement('button'); del.className='btn danger'; del.textContent='Del'; del.addEventListener('click',()=>{ if(confirm('Delete page?')){ data.pages = data.pages.filter(x=>x.id!==p.id); save(); renderPages(); if(editingPageId===p.id) closeEditor(); } }); controls.appendChild(editBtn); controls.appendChild(del); el.appendChild(left); el.appendChild(controls); node.appendChild(el); } }

    // --- Editor ---
    function openEditor(id){ editingPageId = id; const page = data.pages.find(p=>p.id===id); if(!page) return; q('pageEditor').style.display='block'; q('editingTitle').textContent = 'Editing — '+page.title; // populate
      q('heroBehavior').value = page.hero.behavior||'still'; q('heroSize').value = page.hero.size||'medium'; q('heroMedia').value = page.hero.media||''; q('heroParallax').checked = !!page.hero.parallax; q('heroSlides').value = (page.hero.slides||[]).join(', ')
      renderBlocks(); renderHeroPreview();

      // wire save/delete
      q('savePage').onclick = ()=>{ savePageFromEditor(); save(); renderPages(); renderHeroPreview(); }
      q('deletePage').onclick = ()=>{ if(confirm('Delete this page? This cannot be undone.')){ data.pages = data.pages.filter(x=>x.id!==id); save(); renderPages(); closeEditor(); }}

      // live hero inputs
      q('heroBehavior').oninput = ()=>{ page.hero.behavior = q('heroBehavior').value; renderHeroPreview(); save(); }
      q('heroSize').oninput = ()=>{ page.hero.size = q('heroSize').value; save(); renderHeroPreview(); }
      q('heroMedia').oninput = ()=>{ page.hero.media = q('heroMedia').value; save(); renderHeroPreview(); }
      q('heroParallax').onchange = ()=>{ page.hero.parallax = q('heroParallax').checked; save(); renderHeroPreview(); }
      q('heroSlides').oninput = ()=>{ page.hero.slides = q('heroSlides').value.split(',').map(s=>s.trim()).filter(Boolean); save(); renderHeroPreview(); }

    }
    function closeEditor(){ editingPageId=null; q('pageEditor').style.display='none'; }
    function savePageFromEditor(){ const page = data.pages.find(p=>p.id===editingPageId); if(!page) return; // ensure hero slides + media saved
  page.hero.slides = q('heroSlides').value.split(',').map(s=>s.trim()).filter(Boolean);
  page.hero.media = q('heroMedia').value.trim();
  q('lastSaved').textContent = new Date().toLocaleString(); }

    // --- Blocks ---
    function renderBlocks(){ const node = q('blocksList'); node.innerHTML=''; const page = data.pages.find(p=>p.id===editingPageId); if(!page) return; if(page.blocks.length===0) node.innerHTML='<div class="small">No rich text blocks yet.</div>';
      for(const b of page.blocks){ const wrap = document.createElement('div'); wrap.className='list-item'; const left = document.createElement('div'); left.style.flex='1'; left.innerHTML = `<strong>${escapeHtml(b.name)}</strong><div class="small">Type: ${b.type||'rich-text'}</div>`; const controls = document.createElement('div'); controls.className='controls'; const edit = document.createElement('button'); edit.className='btn'; edit.textContent='Edit'; edit.addEventListener('click', ()=>openBlockEditor(b.id)); const del = document.createElement('button'); del.className='btn danger'; del.textContent='Del'; del.addEventListener('click', ()=>{ if(confirm('Delete block?')){ page.blocks = page.blocks.filter(x=>x.id!==b.id); save(); renderBlocks(); } }); controls.appendChild(edit); controls.appendChild(del); wrap.appendChild(left); wrap.appendChild(controls); node.appendChild(wrap); }
    }
    function openBlockEditor(blockId){ const page = data.pages.find(p=>p.id===editingPageId); const block = page.blocks.find(b=>b.id===blockId);
      const modalTitle = prompt('Edit block name', block.name); if(modalTitle===null) return; block.name = modalTitle; const current = block.content || '';
      const edited = prompt('Edit HTML content (you can paste markup). Use \n for newlines.', current);
      if(edited!==null){ block.content = edited; save(); renderBlocks(); }
    }

    qAddBlockListener();
    function qAddBlockListener(){ q('addBlock').addEventListener('click', ()=>{
      if(!editingPageId) return alert('Open a page to add a block'); const page = data.pages.find(p=>p.id===editingPageId);
      const name = q('newBlockTitle').value.trim()||'Block '+(page.blocks.length+1);
      const b = {id:uid(), name:name, type:'rich-text', content:'<p>Edit this block</p>'}; page.blocks.push(b); save(); renderBlocks(); q('newBlockTitle').value=''; openBlockEditor(b.id);
    }) }

    // --- Hero preview ---
    function renderHeroPreview(){ const page = data.pages.find(p=>p.id===editingPageId); const box = q('heroPreview'); box.innerHTML=''; const note = document.createElement('div'); note.className='hero-text'; note.innerHTML = `<strong>Hero preview</strong><div class="small muted-note">Mode: ${page?page.hero.behavior:'—'}</div>`;
      box.appendChild(note);
      if(page){ if(page.hero.behavior==='still' && page.hero.media){ const img = document.createElement('img'); img.src = page.hero.media; box.appendChild(img); }
        if(page.hero.behavior==='carousel' && page.hero.slides && page.hero.slides.length>0){ const img = document.createElement('img'); img.src = page.hero.slides[0]; box.appendChild(img); }
        if(page.hero.behavior==='video' && page.hero.media){ const url = page.hero.media; // show as overlayed link
          const cover = document.createElement('div'); cover.className='small muted-note'; cover.style.position='absolute'; cover.style.bottom='8px'; cover.style.left='8px'; cover.style.background='rgba(0,0,0,0.4)'; cover.style.padding='6px'; cover.style.borderRadius='6px'; cover.textContent = 'Embedded video: '+url; box.appendChild(cover);
        }
      }
    }

    // --- Save / Load ---
    function save(skipPreview){ try{ localStorage.setItem('static_admin_data', JSON.stringify(data)); q('lastSaved').textContent = new Date().toLocaleString(); if(!skipPreview) q('jsonPreview').textContent = JSON.stringify(data, null, 2); } catch(e){ console.error(e); } }
    function loadFromLocal(){ try{ const s = localStorage.getItem('static_admin_data'); return s?JSON.parse(s):null }catch(e){return null} }

    // --- Render full UI ---
    function render(){ renderSettings(); renderImages(); renderPages(); renderBlocks(); q('jsonPreview').textContent = JSON.stringify(data, null, 2); }
    function renderSettings(){ q('transparentHeader').checked = !!data.settings.transparentHeader; }

    function save(forceDownload){ saveInternal(); if(forceDownload){ download('data.json', JSON.stringify(data, null, 2)); } }
    function saveInternal(){ try{ localStorage.setItem('static_admin_data', JSON.stringify(data)); q('lastSaved').textContent = new Date().toLocaleString(); q('jsonPreview').textContent = JSON.stringify(data, null, 2); }catch(e){console.error(e)} }

    // --- Helpers ---
    function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

    // start
    init();
  </script>
</body>
</html>

<!-- HERO SLIDE SYSTEM (REBUILT) -->
<script>
// Slides array UI
function renderSlidesEditor(slides){
  const c=document.getElementById('slidesEditor'); if(!c) return;
  c.innerHTML='';
  slides.forEach((s,i)=>{
    const row=document.createElement('div');
    row.className='slide-row';
    row.innerHTML=`<input class="slide-input" data-idx="${i}" value="${s}" style="width:70%" />
    <button data-idx="${i}" class="remove-slide">Remove</button>`;
    c.appendChild(row);
  });
  const add=document.createElement('button'); add.textContent='Add Slide'; add.onclick=()=>{slides.push(''); renderSlidesEditor(slides);} ;
  c.appendChild(add);
}
// Collect slides before saving
defineCollectSlides=function(){ return [...document.querySelectorAll('.slide-input')].map(e=>e.value.trim()).filter(v=>v); };
</script>


