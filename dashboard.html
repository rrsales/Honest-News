<!-- ==== PART 1/5 START ==== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Honest News – Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- PROTECT DASHBOARD -->
<script>
if (localStorage.getItem("hn_logged") !== "yes") {
  location.href = "admin.html";
}
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
:root {
  --bg:#02040a;--card-bg:#05070c;--border:#1f2937;
  --shadow-soft:0 20px 45px rgba(0,0,0,0.75);
  --accent:#0ea5e9;--accent-soft:#0369a1;
  --accent-soft-bg:rgba(14,165,233,.12);
  --text-main:#e5e7eb;--text-soft:#9ca3af;
  --radius-lg:20px;--radius-md:12px;--radius-pill:999px;
}
*{box-sizing:border-box;}
body {
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
  background:radial-gradient(circle at top,#1e293b 0,#020617 48%,#000 100%);
  color:var(--text-main);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* === HEADER BAR === */
.top-welcome {
  background:linear-gradient(to bottom,#020617,#040712);
  color:white;
  padding:14px 24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid rgba(148,163,184,.35);
  box-shadow:0 18px 40px rgba(0,0,0,.8);
  position:relative;
  z-index:10;
}
.top-left{display:flex;flex-direction:column;gap:2px;}
.top-welcome span.label{letter-spacing:.14em;text-transform:uppercase;font-size:.65rem;color:rgba(148,163,184,.9);}
.top-welcome span.title{font-size:.95rem;}
.top-actions{display:flex;align-items:center;gap:10px;}
.pill-badge {
  font-size:.7rem;padding:3px 9px;border-radius:999px;
  border:1px solid rgba(148,163,184,.5);
  color:#e5e7eb;background:rgba(15,23,42,.9);
  display:inline-flex;align-items:center;gap:6px;
}
.btn {
  border:none;border-radius:var(--radius-pill);cursor:pointer;
  padding:7px 15px;font-size:.8rem;font-weight:600;
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  background:#111827;color:#e5e7eb;
}
.btn.secondary{background:#111827;border:1px solid #1f2937;}
.btn.primary{background:var(--accent);color:#0b1120;border:1px solid var(--accent-soft);}
.logout-btn {
  border:none;border-radius:var(--radius-pill);padding:7px 16px;cursor:pointer;
  font-weight:600;background:rgba(15,23,42,.4);color:#e5e7eb;
  border:1px solid rgba(148,163,184,.4);
  display:inline-flex;align-items:center;gap:6px;
}

/* === MAIN LAYOUT === */
.main {
  flex:1;display:flex;padding:16px;gap:16px;min-height:0;
}
.sidebar {
  width:260px;background:rgba(3,7,18,0.98);border-radius:var(--radius-lg);
  padding:16px 14px;border:1px solid rgba(148,163,184,0.35);
  box-shadow:0 18px 40px rgba(0,0,0,0.85);
  display:flex;flex-direction:column;gap:14px;overflow:hidden;
}
.sidebar-inner{flex:1;overflow-y:auto;padding-right:4px;}
.sidebar-section{margin-bottom:10px;}
.sidebar-section-header {
  width:100%;border:none;background:var(--accent-soft-bg);color:#e5e7eb;
  display:flex;align-items:center;justify-content:space-between;
  cursor:pointer;padding:6px 8px;font-size:.78rem;
  text-transform:uppercase;letter-spacing:.12em;border-radius:12px;
}
.sidebar-chevron{font-size:.7rem;opacity:.7;transition:transform .18s ease;}
.sidebar-chevron.rotated{transform:rotate(-90deg);}
.sidebar-section-body.closed{display:none;}
.page {
  padding:9px 10px;margin-top:6px;border-radius:12px;background:#020617;
  border:1px solid transparent;cursor:pointer;
  display:flex;align-items:center;justify-content:space-between;font-size:.84rem;
}
.page.active {background:var(--accent-soft-bg);border-color:var(--accent);}
.content {flex:1;display:flex;flex-direction:column;min-width:0;}
#previewCard {
  flex:1;background:rgba(3,7,18,0.98);border-radius:var(--radius-lg);padding:12px 14px;
  border:1px solid rgba(148,163,184,0.4);box-shadow:var(--shadow-soft);
  display:flex;flex-direction:column;
}
#heroPreview{position:relative;background-size:cover;background-position:center;}
#heroPreviewOverlay {
  position:absolute;inset:0;
  background:linear-gradient(to bottom,rgba(15,23,42,.35),rgba(15,23,42,.9));
}
#heroPreviewInner {
  position:relative;color:#fff;text-align:center;padding:110px 18px 40px;
}
#heroPreviewInner h1{margin:0;font-size:2.1rem;}
#heroPreviewInner p{margin-top:.6rem;font-size:.96rem;opacity:.9;}

/* === MOBILE SIDEBAR FIX === */
@media (max-width:768px){
  .sidebar{
    position:fixed;top:0;left:-260px;height:100vh;width:260px;border-radius:0;
    transition:left .3s ease;z-index:9999;
  }
  .sidebar.active{left:0;}
  .mobile-toggle{
    display:block;position:fixed;top:14px;left:14px;background:none;border:none;
    color:#e5e7eb;font-size:22px;z-index:10000;
  }
}
@media (min-width:769px){.mobile-toggle{display:none;}}
@media (max-width:900px){.main{flex-direction:column;}.sidebar{width:100%;}}
</style>
</head>

<body>
<div class="top-welcome">
  <button id="menuToggle" class="mobile-toggle"><i class="fas fa-bars"></i></button>
  <div class="top-left">
    <span class="label">Honest News · Dashboard</span>
    <span class="title">Welcome back, Joseph</span>
  </div>
  <div class="top-actions">
    <span class="pill-badge"><i class="fa-regular fa-circle-dot"></i> Publish path: Render → GitHub</span>
    <button class="logout-btn" onclick="localStorage.removeItem('hn_logged');location.href='admin.html'">
      <i class="fa-solid fa-right-from-bracket"></i> Log Out
    </button>
  </div>
</div>

<div class="main">
  <aside class="sidebar">
    <div class="sidebar-section">
      <button class="sidebar-section-header" type="button" onclick="toggleSidebarSection('pages')">
        <span class="label">Pages</span>
        <i class="fa-solid fa-chevron-right sidebar-chevron" id="pagesChevron"></i>
      </button>
      <div class="sidebar-section-body closed" id="pagesSection">
        <div class="sidebar-inner" id="pages"></div>
        <button class="btn secondary" style="width:100%;margin-top:8px;" onclick="newPage()">+ New Page</button>
      </div>
    </div>

    <div class="sidebar-section">
      <button class="sidebar-section-header" type="button" onclick="toggleSidebarSection('nav')">
        <span class="label">Navigation (raw)</span>
        <i class="fa-solid fa-chevron-right sidebar-chevron" id="navChevron"></i>
      </button>
      <div class="sidebar-section-body closed" id="navSection">
        <p class="field-hint">One per line: <code>Title | URL</code></p>
        <textarea id="menuRaw" class="textarea-small" oninput="menuFromRaw(this.value)"></textarea>
      </div>
    </div>
  </aside>

  <section class="content">
    <div id="previewCard">
      <div id="heroPreview">
        <div id="heroPreviewOverlay"></div>
        <div id="heroPreviewInner">
          <h1>Pick a page on the left</h1>
          <p>Then use the sliding panel to edit Page, Hero, Blocks, and Menu.</p>
        </div>
      </div>
    </div>
  </section>
</div>

<div id="panelHandle">◂</div>
<div id="inspectorPanel">
  <p style="padding:1rem;color:#9ca3af;">Inspector Placeholder</p>
</div>
<!-- ==== PART 1/5 END ==== -->
<!-- ==== PART 2/5 START ==== -->
<script>
/* === MOBILE SIDEBAR TOGGLE === */
document.getElementById("menuToggle").addEventListener("click",()=>{
  document.querySelector(".sidebar").classList.toggle("active");
});
document.addEventListener("click",(e)=>{
  const sidebar=document.querySelector(".sidebar");
  const toggle=document.getElementById("menuToggle");
  if(window.innerWidth<=768 && !sidebar.contains(e.target) && !toggle.contains(e.target)){
    sidebar.classList.remove("active");
  }
});

/* =======================
   STATE
======================= */
let site={menu:[],pages:[],theme:{},heroSlides:[]};
let current=null,isDirty=false,activeInspectorTab="page";
const DRAFT_KEY="hn_cms_draft_v1";
let panelBehavior=localStorage.getItem("hn_panel_behavior")||"auto";
const panel=document.getElementById("inspectorPanel");
const handle=document.getElementById("panelHandle");

/* =======================
   INITIALIZE
======================= */
window.addEventListener("beforeunload",(e)=>{
  if(isDirty){e.preventDefault();e.returnValue="Unsaved changes";return"Unsaved changes";}
});
handle.addEventListener("click",()=>{
  panel.classList.toggle("open");
  handle.textContent=panel.classList.contains("open")?"▸":"◂";
});

/* =======================
   LOAD DATA
======================= */
(async function loadSiteData(){
  let loaded=false;
  try{
    const r=await fetch("data.json?cache-bust="+Date.now());
    if(r.ok){const d=await r.json();if(d&&typeof d==="object"){site={...site,...d};loaded=true;}}
  }catch(e){console.warn("Could not load data.json",e);}
  if(!loaded)restoreDraftIfAny();
  renderPages();updatePreview();
})();

/* =======================
   SAVE STATUS
======================= */
function markDirty(){isDirty=true;}
function saveDraft(){
  try{localStorage.setItem(DRAFT_KEY,JSON.stringify(site));isDirty=false;}
  catch(e){alert("Could not save draft");}
}
function restoreDraftIfAny(){
  try{
    const raw=localStorage.getItem(DRAFT_KEY);
    if(!raw)return;
    const d=JSON.parse(raw);
    if(d&&typeof d==="object"){site={...site,...d};}
  }catch(e){console.warn("No valid draft");}
}

/* =======================
   PAGES LIST
======================= */
function renderPages(){
  const c=document.getElementById("pages");
  if(!c)return;
  c.innerHTML=(site.pages||[]).map((p,i)=>`
    <div class="page ${p===current?'active':''}" onclick="selectPage(${i})">
      <div class="page-main">
        <span class="title">${p.title||'Untitled'}</span>
        <span class="slug">${p.slug||''}</span>
      </div>
    </div>`).join("");
}
function newPage(){
  const t=prompt("Page title?");
  if(!t)return;
  const slug=t.toLowerCase().replace(/\s+/g,"-");
  if(!site.pages)site.pages=[];
  site.pages.push({
    title:t,slug,
    theme:"dark",
    hero:{bg:"",overlay:t,sub:"",transparentMenu:false,behavior:"still",size:"full",customHeight:""},
    blocks:[]
  });
  markDirty();renderPages();
}
function selectPage(i){current=site.pages[i];renderPages();updatePreview();}
function deletePage(i){
  if(!confirm("Delete this page?"))return;
  site.pages.splice(i,1);
  if(current===site.pages[i])current=null;
  renderPages();updatePreview();markDirty();
}

/* =======================
   PREVIEW
======================= */
function updatePreview(){
  const h=current&&current.hero?current.hero:{overlay:"Pick a page",sub:"Use left bar"};
  const hero=document.getElementById("heroPreview");
  const t=document.querySelector("#heroPreviewInner h1");
  const s=document.querySelector("#heroPreviewInner p");
  t.textContent=h.overlay||"";s.textContent=h.sub||"";
  hero.style.backgroundImage=h.bg?`url('${h.bg}')`:"none";
}
/* =======================
   HERO SETTINGS
======================= */
function setHeroField(f,v){if(!current||!current.hero)return;current.hero[f]=v;updatePreview();markDirty();}
function toggleHeroTransparency(){if(!current)return;current.hero.transparentMenu=!current.hero.transparentMenu;markDirty();}
function changeHeroBehavior(v){if(!current)return;current.hero.behavior=v;markDirty();}
function changeHeroSize(v){if(!current)return;current.hero.size=v;markDirty();}
function changeHeroCustomHeight(v){if(!current)return;current.hero.customHeight=v;markDirty();}

/* =======================
   MENU BUILDER
======================= */
function menuFromRaw(t){
  const lines=t.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  site.menu=lines.map((l,i)=>{
    const [title,url]=l.split("|").map(s=>(s||"").trim());
    return{id:(title||"item-"+i).toLowerCase().replace(/\s+/g,"-"),label:title||"Item",url:url||"#"};
  });
  markDirty();
}

/* =======================
   PANEL TABS
======================= */
function renderInspectorTab(tab){activeInspectorTab=tab;}
function toggleSidebarSection(id){
  const body=document.getElementById(id+"Section");
  const chevron=document.getElementById(id+"Chevron");
  body.classList.toggle("closed");
  chevron.classList.toggle("rotated");
}
<!-- ==== PART 2/5 END ==== -->
<!-- ==== PART 3/5 START ==== -->
/* =======================
   BLOCKS / CONTENT EDITOR
======================= */
function addBlock(){
  if(!current)return;
  current.blocks.push({type:"text",content:"New block"});
  markDirty();renderBlocks();
}
function deleteBlock(i){
  if(!current)return;
  current.blocks.splice(i,1);
  markDirty();renderBlocks();
}
function renderBlocks(){
  const container=document.getElementById("blocksArea");
  if(!container||!current)return;
  container.innerHTML=current.blocks.map((b,i)=>`
    <div class="block">
      <textarea onchange="editBlock(${i},this.value)">${b.content||""}</textarea>
      <button class="btn secondary" onclick="deleteBlock(${i})">Delete</button>
    </div>`).join("");
}
function editBlock(i,val){
  if(!current)return;
  current.blocks[i].content=val;
  markDirty();
}

/* =======================
   IMAGE LIBRARY (BASIC)
======================= */
function addImageToLibrary(url){
  if(!site.library)site.library=[];
  site.library.push(url);
  markDirty();renderLibrary();
}
function renderLibrary(){
  const el=document.getElementById("imageLibrary");
  if(!el||!site.library)return;
  el.innerHTML=site.library.map(u=>`
    <div class="img-thumb" onclick="selectHeroImage('${u}')">
      <img src="${u}"/>
    </div>`).join("");
}
function selectHeroImage(url){
  if(!current||!current.hero)return;
  current.hero.bg=url;
  markDirty();updatePreview();
}

/* =======================
   INSPECTOR (PAGE/HERO)
======================= */
function openInspector(){
  panel.classList.add("open");
  handle.textContent="▸";
}
function closeInspector(){
  panel.classList.remove("open");
  handle.textContent="◂";
}
function setInspectorTab(tab){
  document.querySelectorAll(".inspector-tab").forEach(t=>t.classList.remove("active"));
  document.getElementById("tab-"+tab).classList.add("active");
  activeInspectorTab=tab;
}

/* =======================
   PUBLISH / EXPORT
======================= */
async function publish(){
  try{
    const zip=new JSZip();
    zip.file("data.json",JSON.stringify(site,null,2));
    const blob=await zip.generateAsync({type:"blob"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download="honest-news-data.zip";a.click();
    URL.revokeObjectURL(url);
    isDirty=false;
  }catch(e){alert("Publish failed: "+e);}
}

/* =======================
   KEYBOARD SHORTCUTS
======================= */
document.addEventListener("keydown",e=>{
  if(e.metaKey&&e.key.toLowerCase()==="s"){e.preventDefault();saveDraft();}
  if(e.shiftKey&&e.key.toLowerCase()==="p"){e.preventDefault();publish();}
});
<!-- ==== PART 3/5 END ==== -->

<!-- ==== PART 4/5 START ==== -->
/* =======================
   PANEL HANDLE / BEHAVIOR
======================= */
const dragZone=document.createElement("div");
dragZone.id="dragZone";
dragZone.style.position="absolute";
dragZone.style.top=0;
dragZone.style.left=0;
dragZone.style.width="5px";
dragZone.style.height="100%";
dragZone.style.cursor="ew-resize";
panel.appendChild(dragZone);

let isDragging=false;
dragZone.addEventListener("mousedown",()=>{isDragging=true;document.body.style.userSelect="none";});
window.addEventListener("mouseup",()=>{isDragging=false;document.body.style.userSelect="auto";});
window.addEventListener("mousemove",(e)=>{
  if(!isDragging)return;
  const w=Math.min(Math.max(e.clientX,250),window.innerWidth-200);
  panel.style.width=w+"px";
});

/* =======================
   SIMPLE STATUS INDICATORS
======================= */
function showStatus(msg,type="info"){
  const bar=document.getElementById("statusBar");
  if(!bar)return;
  bar.textContent=msg;
  bar.className="status "+type;
  setTimeout(()=>{bar.textContent="";bar.className="status";},3000);
}

/* =======================
   INITIAL RENDER CALLS
======================= */
document.addEventListener("DOMContentLoaded",()=>{
  renderPages();
  updatePreview();
  if(site.library)renderLibrary();
});
<!-- ==== PART 4/5 END ==== -->
<!-- ==== PART 5/5 START ==== -->
</script>

<!-- Optional status bar -->
<div id="statusBar" class="status" style="position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
background:#0ea5e9;color:#0b1120;padding:6px 14px;border-radius:12px;font-size:.8rem;z-index:99999;"></div>

</body>
</html>
<!-- ==== PART 5/5 END ==== -->



